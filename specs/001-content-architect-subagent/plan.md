# Implementation Plan: Content Architect Subagent

**Branch**: `001-content-architect-subagent` | **Date**: 2025-11-28 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/001-content-architect-subagent/spec.md`

**Note**: This template is filled in by the `/sp.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

The Content Architect Subagent automates the scaffolding of a Docusaurus textbook structure for the Physical AI & Humanoid Robotics course. It reads COURSE_CONTENT.md, generates directory structures for 3 chapters with 2 lessons each (6 lessons total), creates _category_.json configuration files, updates sidebars.ts, and generates lesson placeholder markdown files with standardized templates. The subagent is implemented as a Claude Code agent (.claude/agents/content-architect.md) that uses filesystem operations and template generation to produce a complete, Docusaurus-compatible directory structure ready for content writing.

## Technical Context

**Language/Version**: Markdown (Claude Code Agent specification) + Node.js 20+ (for Docusaurus runtime)
**Primary Dependencies**:
- Claude Code agent runtime (executes .claude/agents/*.md files)
- Docusaurus 3.x (target platform for generated structure)
- COURSE_CONTENT.md (input data source)
- Filesystem access (Read, Write, Glob tools)

**Storage**: Filesystem-based (creates .md files, .json configs, updates .ts files)
**Testing**:
- Manual verification (invoke agent, inspect generated structure)
- Automated validation via Bash script checking file existence
- Docusaurus build test (npm run build should pass)

**Target Platform**: Claude Code agent runtime on Linux/WSL2
**Project Type**: Automation agent (code generation tool)
**Performance Goals**:
- Complete scaffolding execution in <30 seconds (SC-001 from spec)
- Generate 6 lesson files with zero manual intervention (SC-002)

**Constraints**:
- Must preserve existing content when re-run (idempotent, FR-011)
- Must not overwrite files without user confirmation (FR-008)
- Must generate valid TypeScript syntax for sidebars.ts (SC-007)
- Must work within docs/docs/ directory structure (assumption 2 from spec)

**Scale/Scope**:
- Phase 1: 3 chapters × 2 lessons = 6 lesson files
- Future: Expandable to 6 chapters × 4 lessons = 24 lesson files (US-003)
- 3 _category_.json files + 1 sidebars.ts update per execution

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

| Principle | Status | Rationale |
|-----------|--------|-----------|
| **I. Content-First Development** | ✅ PASS | Subagent scaffolds textbook structure to unblock content writing. Directly serves the goal of delivering educational material. |
| **II. AI-Assisted Spec-Driven Workflow** | ✅ PASS | Following /sp.specify → /sp.plan → /sp.tasks → /sp.implement workflow. This plan documents design before implementation. |
| **III. Progressive Enhancement Architecture** | ✅ PASS | Content Architect is part of base functionality (textbook structure). Must complete before RAG chatbot integration. |
| **IV. Reusable Intelligence (Subagents & Skills)** | ✅ PASS | This IS the first reusable subagent (+50 bonus points). Can be reused for any Docusaurus textbook project. |
| **V. User-Centered Personalization** | N/A | Not applicable to structure scaffolding agent. |
| **VI. Multilingual Accessibility** | N/A | Not applicable to structure scaffolding agent. |
| **VII. Performance & Scalability Standards** | ✅ PASS | Targets <30s execution (SC-001). Filesystem operations are fast. No network/DB bottlenecks. |
| **VIII. Test-Before-Implement Discipline** | ✅ PASS | Will write validation tests checking file existence, Docusaurus build success, and sidebar syntax validity before implementation. |
| **IX. Documentation as Code** | ✅ PASS | This plan.md, research.md, data-model.md, and contracts/ document the subagent design through Spec-Kit Plus templates. |

**Overall Status**: ✅ **ALL GATES PASS** - No violations or complexity justifications required.

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/sp.plan command output)
├── research.md          # Phase 0 output (/sp.plan command)
├── data-model.md        # Phase 1 output (/sp.plan command)
├── quickstart.md        # Phase 1 output (/sp.plan command)
├── contracts/           # Phase 1 output (/sp.plan command)
└── tasks.md             # Phase 2 output (/sp.tasks command - NOT created by /sp.plan)
```

### Source Code (repository root)

```text
.claude/
└── agents/
    └── content-architect.md         # The subagent implementation

docs/
├── docs/                            # Generated output directory
│   ├── chapter-01-foundations/      # Generated by agent
│   │   ├── _category_.json          # Generated by agent
│   │   ├── lesson-01-*.md           # Generated by agent
│   │   └── lesson-02-*.md           # Generated by agent
│   ├── chapter-02-ros2/             # Generated by agent
│   │   ├── _category_.json          # Generated by agent
│   │   ├── lesson-01-*.md           # Generated by agent
│   │   └── lesson-02-*.md           # Generated by agent
│   └── chapter-03-simulation/       # Generated by agent
│       ├── _category_.json          # Generated by agent
│       ├── lesson-01-*.md           # Generated by agent
│       └── lesson-02-*.md           # Generated by agent
└── sidebars.ts                      # Updated by agent

COURSE_CONTENT.md                    # Input data source (repository root)

specs/001-content-architect-subagent/
├── plan.md                          # This file
├── research.md                      # Phase 0 output
├── data-model.md                    # Phase 1 output
├── quickstart.md                    # Phase 1 output
└── contracts/                       # Phase 1 output
    ├── agent-interface.md           # Agent invocation contract
    ├── lesson-template.md           # Lesson file template specification
    ├── category-schema.json         # _category_.json schema
    └── sidebar-update-rules.md      # Sidebar modification rules
```

**Structure Decision**: This is an **agent-only project** - no traditional src/ directory. The "source code" is the agent specification file (.claude/agents/content-architect.md) that Claude Code executes. The agent generates output files in docs/docs/ following Docusaurus conventions. All design contracts are documented in specs/001-content-architect-subagent/contracts/ to define the agent's behavior and output formats.

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**No violations detected.** All constitution gates pass without requiring complexity justification.

---

# Phase 0: Research & Technical Decisions

*See [research.md](./research.md) for detailed findings.*

## Research Summary

**Status**: ✅ Complete

**Key Decisions Made**:
1. **Agent Format**: Markdown with YAML frontmatter (.claude/agents/content-architect.md)
2. **_category_.json Schema**: Docusaurus standard (label, position, collapsed, link)
3. **Sidebar Updates**: Template-based string insertion to preserve manual edits
4. **Lesson Frontmatter**: sidebar_position, title, description (YAML)
5. **Slug Generation**: kebab-case conversion algorithm
6. **Content Parsing**: Module header extraction with Weekly breakdown fallback
7. **Lesson Template**: 7 mandatory sections (Introduction, Learning Objectives, Key Concepts, Hands-on Exercise, Quiz, Key Takeaways, Further Reading)
8. **Idempotency**: File existence checks + user confirmation for overwrites
9. **Validation**: Multi-level (file existence, syntax, Docusaurus build)
10. **Error Handling**: Fail fast with clear error messages

**All unknowns resolved.** Ready for Phase 1 design.

---

# Phase 1: Design & Implementation Planning

*See design artifacts below for detailed specifications.*

## Phase 1 Summary

**Status**: ✅ Complete

**Artifacts Created**:

### 1. Data Model ([data-model.md](./data-model.md))
- **Entities Defined**: CourseContent, Module, Lesson, CategoryConfiguration, SidebarConfiguration, SidebarCategory, LessonTemplate
- **Relationships Documented**: 1:N, 1:1 relationships with referential integrity rules
- **State Transitions**: 6-step agent execution flow (Parse → Validate → Generate Chapters → Generate Lessons → Update Sidebar → Validate Output)
- **Persistence Strategy**: Filesystem-based with mutability rules

### 2. Contracts ([contracts/](./contracts/))

#### a. Agent Interface ([agent-interface.md](./contracts/agent-interface.md))
- **Invocation**: `claude agent content-architect`
- **Input Contract**: COURSE_CONTENT.md (required), Chapter Selection (interactive prompt)
- **Output Contract**: Directory structure, lesson files, updated sidebars.ts, console summary
- **Behavioral Contract**: Idempotency rules, preservation of manual edits, validation strategy
- **Performance Contract**: <30s execution time for 6 lessons
- **Error Handling**: 4 error categories with recovery strategies

#### b. Lesson Template ([lesson-template.md](./contracts/lesson-template.md))
- **Template Structure**: Complete Markdown template with 7 mandatory sections
- **Placeholder Variables**: Frontmatter + content variables with fill strategies
- **Section Specifications**: Detailed requirements for each section
- **Validation Rules**: Template completeness and content quality checks

#### c. Category Schema ([category-schema.json](./contracts/category-schema.json))
- **JSON Schema**: Draft-07 compliant schema for _category_.json
- **Required Fields**: label, position
- **Optional Fields**: collapsed, collapsible, className, link, customProps
- **Examples**: 3 complete example configurations

#### d. Sidebar Update Rules ([sidebar-update-rules.md](./contracts/sidebar-update-rules.md))
- **Update Strategy**: 7-step process (Read → Parse → Detect Duplicates → Generate → Insert → Validate → Write)
- **Preservation Rules**: Preserve existing items, comments, formatting, custom properties
- **Edge Cases**: Empty sidebar, multiple sidebars, autogenerated sidebars, nested categories
- **Validation Checklist**: 8 validation points

### 3. Quickstart Guide ([quickstart.md](./quickstart.md))
- **Prerequisites**: COURSE_CONTENT.md, Docusaurus project, Claude Code, write permissions
- **Quick Start**: 6-step process from invocation to verification
- **Usage Examples**: Initial scaffolding, adding lessons, adding chapters
- **Common Issues**: 5 common issues with solutions
- **Advanced Usage**: Custom chapter selection, overwriting files, manual validation

### 4. Agent Context Update
- **Status**: ✅ Updated via `.specify/scripts/bash/update-agent-context.sh claude`
- **Changes**: Added Markdown + Node.js 20+ language, Filesystem storage
- **Target**: CLAUDE.md updated with new technology context

---

## Phase 1 Constitution Re-Check

*Re-validate against all 9 constitution principles after design completion.*

| Principle | Status | Post-Design Notes |
|-----------|--------|-------------------|
| **I. Content-First Development** | ✅ PASS | Design prioritizes enabling content creation. Lesson templates guide writers effectively. |
| **II. AI-Assisted Spec-Driven Workflow** | ✅ PASS | Complete spec → plan → design workflow followed. All artifacts documented. |
| **III. Progressive Enhancement Architecture** | ✅ PASS | Agent scaffolds base structure. Technical Writer adds content layer. Modular design. |
| **IV. Reusable Intelligence (Subagents & Skills)** | ✅ PASS | Agent is fully reusable for any Docusaurus textbook project. Contracts enable portability. |
| **V. User-Centered Personalization** | N/A | Not applicable to scaffolding agent. |
| **VI. Multilingual Accessibility** | N/A | Not applicable to scaffolding agent. |
| **VII. Performance & Scalability Standards** | ✅ PASS | Design targets <30s execution. Filesystem operations are fast. Validation strategy optimized. |
| **VIII. Test-Before-Implement Discipline** | ✅ PASS | Validation checklist defined. Contract tests specified in agent-interface.md. Ready for /sp.tasks. |
| **IX. Documentation as Code** | ✅ PASS | 6 design documents created. Full traceability from spec → research → data model → contracts → quickstart. |

**Overall Status**: ✅ **ALL GATES PASS** - Design complete and constitution-compliant.

---

## Ready for Next Steps

**Phase 0 (Research)**: ✅ Complete
**Phase 1 (Design)**: ✅ Complete
**Phase 2 (Tasks)**: Ready to run `/sp.tasks` to generate implementation tasks

**Next Command**: `/sp.tasks` - Generate actionable tasks from this plan

---

**Planning complete. All design artifacts created and validated.**
